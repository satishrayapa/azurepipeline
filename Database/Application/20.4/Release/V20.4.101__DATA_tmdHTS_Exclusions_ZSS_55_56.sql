-- tmdhts_Exclusions updates
IF EXISTS (select * from dbo.sysobjects where id = object_id(N'[dbo].[tmdhts_Exclusions]') and OBJECTPROPERTY(id, N'IsUserTable') = 1)
BEGIN  
	IF Object_ID('tempdb..#tmdhts_Exclusions') IS NOT NULL DROP TABLE #tmdhts_Exclusions
	Declare @Exclusion AS Varchar(8)
	Declare @CountryCode AS Varchar(2)
	Declare @StartEffDate AS Date
	Declare @EndEffDate AS Date
	Set @Exclusion = '99038855'
	Set @CountryCode = 'CN'
	Set @StartEffDate = '9/1/2019'
	Set @EndEffDate = '9/1/2020'
	Create Table #tmdhts_Exclusions(HTSNum Varchar(10))

	INSERT INTO #tmdhts_Exclusions(HTSNum)  
	VALUES	
('3926909985'),
('7013999010'),
('7013999090'),
('8443321050'),
('8471608000'),
('9506996080');

	MERGE dbo.tmdHTS_Exclusions dt
		USING #tmdHTS_Exclusions te
			ON  dt.HTSNum			= te.HTSNum 		
			AND dt.Exclusion		= @Exclusion
			AND dt.CountryOfOrigin	= @CountryCode		
	WHEN MATCHED
			THEN UPDATE SET
				dt.StartEffDate		= @StartEffDate
				,dt.EndEffDate		= @EndEffDate
	WHEN NOT MATCHED BY TARGET
			THEN INSERT (HTSNum, Exclusion, CountryOfOrigin, StartEffDate, EndEffDate) 
			VALUES (te.HTSNum, @Exclusion, @CountryCode, @StartEffDate, @EndEffDate);


	TRUNCATE TABLE #tmdhts_Exclusions
	Set @Exclusion = '99038856'
	Set @StartEffDate = '8/7/2020'
	Set @EndEffDate = '12/31/2020'
	
	INSERT INTO #tmdhts_Exclusions(HTSNum)  
	VALUES	
('3923109000'),
('3923500000'),
('5603920090'),
('8716905060'),
('4402100000'),
('4823700040'),
('7321906090'),
('7616995190'),
('8302500000'),
('8471609050'),
('8473301180'),
('8473305100'),
('8504406018'),
('8708305090'),
('8712002500'),
('9405408440'),
('9405504000'),
('9405994090'),
('3204179050'),
('3702440160'),
('4016996050'),
('4823610040'),
('5407522060'),
('5603120090'),
('6001102000'),
('7016100000'),
('7315120080'),
('7326908688'),
('7501200000'),
('8418500080'),
('8516290030'),
('8516290090'),
('8534000040'),
('8537109170'),
('8543709100'),
('8544422000'),
('8544429090'),
('8708295060'),
('8708998180'),
('8714913000'),
('9001909000'),
('9015900190'),
('9401905081'),
('9403896003'),
('4411939090'),
('5007200065'),
('5007200085'),
('8207907585'),
('8425190000'),
('8504408500'),
('8544429010'),
('8716903000'),
('9401790015'),
('9401790035'),
('9403200050'),
('2805110000'),
('6909112000'),
('8508110000'),
('8511400000'),
('9403200090'),
('0304725000'),
('0304831015'),
('0304831020'),
('0304835090'),
('8708508500'),
('8712001520'),
('0803900045'),
('0813300000'),
('0813404000'),
('0813409000'),
('0813500020'),
('8423810040'),
('4010359000'),
('5407619930'),
('5407619935'),
('5407720015'),
('5512190090'),
('5514220020'),
('5810929080'),
('7308305050'),
('8409919990'),
('8413200000'),
('8413309060'),
('8414200000'),
('8414596540'),
('8414801685'),
('8425310100'),
('8479899499'),
('8512902000'),
('8525803010'),
('8546900000'),
('8712001510'),
('8712001550'),
('8714950000'),
('9011800000'),
('9401710031'),
('9401904080'),
('9403906005'),
('0304835015'),
('0304835020'),
('1605102010'),
('1605102022'),
('1605102030'),
('1605102090'),
('3402201100'),
('3808931500'),
('3815110000'),
('3815190000'),
('4015191010'),
('5705002030'),
('7009100000'),
('8452299000'),
('8481805090'),
('8501404040'),
('8534000020'),
('8536698000'),
('8712003500'),
('8716400000'),
('9029108000'),
('9401616011'),
('9403200081'),
('9403820015'),
('9403908041'),
('9405408410'),
('4202923131'),
('4205008000'),
('5603949090'),
('6003406000'),
('6505008015'),
('7321111060'),
('8425490000'),
('8470900190'),
('3923210095'),
('3926209050'),
('2917125000'),
('2929905090'),
('3810902000'),
('4202923120'),
('4820102060'),
('4823700020'),
('5108108000'),
('5501200000'),
('5501400000'),
('6802990060'),
('7007190000'),
('7308301000'),
('8413309090'),
('8501402040'),
('8501406040'),
('8504508000'),
('8531200040'),
('8712004800'),
('8708407570'),
('2926200000'),
('3824780020'),
('3824999297'),
('4202128130'),
('4202920400'),
('8409919290'),
('8414596560'),
('8414901040'),
('8423810030'),
('8424909080'),
('8483101050'),
('8501402020'),
('8501404020'),
('8504409580'),
('8516604070'),
('8516808000'),
('8546200090'),
('9106908500'),
('3401305000'),
('3801105000'),
('3801900000'),
('4819504060'),
('8205513030'),
('8414100000'),
('9025900600'),
('9401790050'),
('5603149090'),
('5603930090'),
('5701901010'),
('7308400000'),
('8303000000'),
('8412909081'),
('8426300000'),
('8708996890');

	MERGE dbo.tmdHTS_Exclusions dt
		USING #tmdHTS_Exclusions te
			ON  dt.HTSNum			= te.HTSNum 		
			AND dt.Exclusion		= @Exclusion
			AND dt.CountryOfOrigin	= @CountryCode		
	WHEN MATCHED
			THEN UPDATE SET
				dt.StartEffDate		= @StartEffDate
				,dt.EndEffDate		= @EndEffDate
	WHEN NOT MATCHED BY TARGET
			THEN INSERT (HTSNum, Exclusion, CountryOfOrigin, StartEffDate, EndEffDate) 
			VALUES (te.HTSNum, @Exclusion, @CountryCode, @StartEffDate, @EndEffDate);

	IF OBJECT_ID('tempdb..#tmdhts_Exclusions') IS NOT NULL DROP TABLE #tmdhts_Exclusions
END
